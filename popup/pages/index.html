<!DOCTYPE html>
<html>
  <head>
    <title>Azure Pull Request Protect - Settings</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../style/index.css" />
  </head>
  <body>
    <div class="container">
      <header class="header">
        <h1>Azure Pull Request Protect</h1>
        <p class="subtitle">Protecting you, from yourself!</p>
      </header>

      <div class="settings-section">
        <h2 class="section-title">Welcome</h2>
        <p class="section-description">This extension helps protect your Azure DevOps pull requests by enforcing branch policies.</p>
        
        <div class="info-card">
          <h3 style="font-size: 16px; margin-bottom: 12px; color: #2d3748;">How it works:</h3>
          <ol style="padding-left: 20px; color: #4a5568; line-height: 1.8;">
            <li>Navigate to an Azure DevOps pull request</li>
            <li>If the pull request violates any branch policies, the "Complete" button will be marked and a warning message will be displayed</li>
            <li>Review the violated policies and make necessary changes to your pull request</li>
            <li>Configure your policies in the Settings page</li>
          </ol>
        </div>
      </div>

      <div class="settings-section">
        <h2 class="section-title">General</h2>
        <p class="section-description">These are the general settings for Azure Pull Request Protect.</p>
        <div class="setting-item">
          <label class="setting-label">
            <input type="checkbox" id="verboseLogging" name="verboseLogging" class="setting-checkbox">
            <span>Verbose Logging</span>
          </label>
          <p class="setting-description">Enable detailed console logging for debugging</p>
        </div>

        <div class="setting-item">
          <label class="setting-label">
            <input type="checkbox" id="disableCompleteOnPolicyViolation" name="disableCompleteOnPolicyViolation" class="setting-checkbox">
            <span>Disable Complete on Policy Violation</span>
          </label>
          <p class="setting-description">Prevent completing pull requests that violate branch policies</p>
        </div>

        <div class="setting-item">
          <label class="setting-label">
            <input type="checkbox" id="customReleaseBranchLogic" name="customReleaseBranchLogic" class="setting-checkbox">
            <span>Use Custom Release Branch Logic</span>
          </label>
          <p class="setting-description">Use a custom logic to determine if a release branch is sealed</p>
          <p class="setting-description-note">Custom relase branch logic is documented <a target="_blank" rel="noopener noreferrer" href="https://github.com/srz2/Azure-Pull-Request-Protect/blob/main/docs/custom-logic/CustomReleaseBranchLogic.md">here</a></p>
        </div>
      </div>

      <div class="devops-section">
        <h2 class="section-title">Azure DevOps Settings</h2>
        <p class="section-description">These are the settings that will be used to connect to your Azure DevOps organization.</p>
        <div class="form-row">
          <label for="azureDevOpsOrganization">Organization</label>
          <input type="text" id="azureDevOpsOrganization" placeholder="e.g. my-organization" />
        </div>
        <div class="form-row">
          <label for="azureDevOpsProject">Project</label>
          <input type="text" id="azureDevOpsProject" placeholder="e.g. my-project" />
        </div>
        <div class="form-row">
          <label for="azureDevOpsTeam">Team</label>
          <input type="text" id="azureDevOpsTeam" placeholder="e.g. my-team" />
        </div>
        <div class="form-row form-row-flex-end">
          <button id="test-connection-button">Test Connection</button>
        </div>
        <div class="form-row form-row-flex-center">
          <p id="dev-ops-status-label" class="ado-status-hide"></p>
        </div>
      </div>

      <div class="policies-section">
        <div class="section-header">
          <h2 class="section-title">Branch Policies</h2>
          <p class="section-description">These are the branch policies that will be checked for in pull requests.</p>
          <button type="button" id="new-policy-btn" class="new-policy-btn">+ New Policy</button>
        </div>
        <div id="new-policy-form" class="new-policy-form hidden">
          <h3 class="form-title">Add Branch Policy</h3>
          <div class="form-row">
            <label for="new-policy-source">Source branch pattern</label>
            <input type="text" id="new-policy-source" placeholder="e.g. feature/* or main" />
          </div>
          <div class="form-row">
            <label for="new-policy-target">Target branch pattern</label>
            <input type="text" id="new-policy-target" placeholder="e.g. main or release/*" />
          </div>
          <div class="form-row">
            <label for="new-policy-description">Description</label>
            <textarea id="new-policy-description" rows="2" placeholder="e.g. Feature branches should not be merged directly into main."></textarea>
          </div>
          <div class="form-actions">
            <button type="button" id="new-policy-cancel" class="btn-cancel">Cancel</button>
            <button type="button" id="new-policy-save" class="btn-save">Save Policy</button>
          </div>
        </div>
        <div id="policies-list" class="policies-list">
          <!-- Policies will be dynamically inserted here -->
        </div>
      </div>

      <div class="other-info-section">
        <div class="form-row">
          <p>This project is open sourced.</p>
          <p>View the repo on <a href="https://github.com/srz2/azure-pull-request-protect" target="_blank" rel="noopener noreferrer">GitHub</a><svg width="800" height="800" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><path style="fill:none" d="M0-192h1280v800H0z"/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><path d="M32.029 8.345C18.759 8.345 8 19.104 8 32.378c0 10.617 6.885 19.624 16.435 22.803 1.202.22 1.64-.522 1.64-1.16 0-.569-.02-2.081-.032-4.086-6.685 1.452-8.095-3.222-8.095-3.222-1.093-2.775-2.669-3.514-2.669-3.514-2.182-1.492.165-1.462.165-1.462 2.412.171 3.681 2.477 3.681 2.477 2.144 3.672 5.625 2.611 6.994 1.997.219-1.553.838-2.612 1.526-3.213-5.336-.606-10.947-2.669-10.947-11.877 0-2.623.937-4.769 2.474-6.449-.247-.608-1.072-3.051.235-6.36 0 0 2.018-.646 6.609 2.464 1.917-.533 3.973-.8 6.016-.809 2.041.009 4.097.276 6.017.809 4.588-3.11 6.602-2.464 6.602-2.464 1.311 3.309.486 5.752.239 6.36 1.54 1.68 2.471 3.826 2.471 6.449 0 9.232-5.62 11.263-10.974 11.858.864.742 1.632 2.208 1.632 4.451 0 3.212-.029 5.804-.029 6.591 0 .644.432 1.392 1.652 1.157 9.542-3.185 16.421-12.186 16.421-22.8 0-13.274-10.76-24.033-24.034-24.033" style="fill:#010101"/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg></p>
        </div>
      </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal-overlay hidden">
      <div class="modal-content">
        <h3 class="modal-title">Delete Policy</h3>
        <p class="modal-message">Are you sure you want to delete this policy?</p>
        <div class="modal-policy-info">
          <span id="modal-policy-info-text"></span>
        </div>
        <p class="modal-warning">This action cannot be undone.</p>
        <div class="modal-actions">
          <button type="button" id="delete-modal-cancel" class="modal-btn-cancel">Cancel</button>
          <button type="button" id="delete-modal-confirm" class="modal-btn-delete">Delete</button>
        </div>
      </div>
    </div>

    <!-- Script for popup -->
    <script src="../../scripts/defaults.js"></script>
    <script src="../scripts/index.js"></script>
    <script src="../../scripts/AzureDevOpsService.js"></script>
  </body>
</html>